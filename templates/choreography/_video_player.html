{% comment %}
Shared video player component
Used by both select-song and describe-choreo templates

Required Alpine.js data:
- result (object with video_filename)
- videoDuration, currentTime, progressPercentage, isPlaying
- isLooping, loopStart, loopEnd
- Methods from videoPlayerMixin
{% endcomment %}

<!-- Video Player -->
<div class="mb-6">
    <video x-ref="videoPlayer"
           :src="result ? `/video/${result.video_filename}/` : ''"
           @timeupdate="updateVideoProgress()"
           @ended="handleVideoEnd()"
           @loadedmetadata="initVideoPlayer()"
           controls
           class="w-full rounded-xl shadow-lg">
    </video>
</div>

<!-- Video Controls -->
<div class="mb-6">
    <!-- Play/Pause Button -->
    <div class="flex justify-center mb-4">
        <button @click="togglePlayPause()"
                class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-semibold transition-colors">
            <span x-show="!isPlaying">‚ñ∂Ô∏è Play</span>
            <span x-show="isPlaying">‚è∏Ô∏è Pause</span>
        </button>
    </div>

    <!-- Progress Bar with Click-to-Seek -->
    <div class="relative w-full h-3 bg-gray-200 rounded-full cursor-pointer mb-2"
         @click="seekToPosition($event)">
        <!-- Current Progress -->
        <div class="absolute h-full bg-blue-500 rounded-full transition-all"
             :style="`width: ${progressPercentage}%`"></div>
        
        <!-- Loop Segment Indicator -->
        <div x-show="isLooping && loopStart >= 0"
             class="absolute h-full bg-green-300 opacity-50 rounded-full"
             :style="`left: ${loopStartPercentage}%; width: ${loopSegmentWidth}%`">
        </div>
    </div>

    <!-- Time Display -->
    <div class="flex justify-between text-sm text-gray-600">
        <span x-text="formatTime(currentTime)"></span>
        <span x-text="formatTime(videoDuration)"></span>
    </div>
</div>

<!-- Loop Controls -->
<div class="mb-6 p-4 bg-gray-50 rounded-xl">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-800">üîÅ Loop Controls</h3>
        <button @click="toggleLoop()"
                :class="isLooping ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-400 hover:bg-gray-500'"
                class="text-white px-4 py-2 rounded-lg font-semibold transition-colors">
            <span x-show="!isLooping">Enable Loop</span>
            <span x-show="isLooping">Disable Loop</span>
        </button>
    </div>

    <!-- Loop Adjustment Controls -->
    <div x-show="isLooping" x-cloak class="space-y-3">
        <!-- Loop Start -->
        <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-700">Loop Start:</span>
            <div class="flex items-center space-x-2">
                <button @click="adjustLoopStart(-1)"
                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                    -1s
                </button>
                <span class="text-lg font-mono font-bold text-purple-600 w-16 text-center" 
                      x-text="formatTime(loopStart)"></span>
                <button @click="adjustLoopStart(1)"
                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                    +1s
                </button>
            </div>
        </div>

        <!-- Loop End -->
        <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-700">Loop End:</span>
            <div class="flex items-center space-x-2">
                <button @click="adjustLoopEnd(-1)"
                        class="bg-pink-500 hover:bg-pink-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                    -1s
                </button>
                <span class="text-lg font-mono font-bold text-pink-600 w-16 text-center" 
                      x-text="formatTime(loopEnd)"></span>
                <button @click="adjustLoopEnd(1)"
                        class="bg-pink-500 hover:bg-pink-600 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                    +1s
                </button>
            </div>
        </div>

        <!-- Loop Duration -->
        <div class="text-center text-sm text-gray-600 pt-2 border-t border-gray-200">
            Loop Duration: <span class="font-bold" x-text="formatTime(loopEnd - loopStart)"></span>
        </div>
    </div>
</div>
